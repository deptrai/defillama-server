# DeFiLlama Server - Component Inventory

*Generated by BMAD Method v6.0.0-alpha.0 on 2025-10-13*

## üì¶ Service Components

### üè¶ DeFi Service (`defi/`)

**Service Overview**: Main DeFi analytics API providing TVL data, protocol information, and DeFi ecosystem insights

#### Core Components

| Component | Type | Purpose | Technology | Status |
|-----------|------|---------|------------|--------|
| **API Gateway** | REST API | Main API endpoints for DeFi data | Serverless + AWS API Gateway | ‚úÖ Active |
| **TVL Calculator** | Business Logic | Calculate Total Value Locked for protocols | TypeScript + ethers.js | ‚úÖ Active |
| **Protocol Manager** | Data Service | Manage protocol metadata and configurations | TypeScript + DynamoDB | ‚úÖ Active |
| **Adapter Engine** | Integration | Execute protocol-specific data adapters | TypeScript + @defillama/sdk | ‚úÖ Active |
| **Historical Data Service** | Data Service | Store and retrieve historical TVL data | TypeScript + PostgreSQL | ‚úÖ Active |
| **Governance Integration** | Data Service | Track governance proposals and voting | TypeScript + Snapshot API | ‚úÖ Active |
| **Emissions Tracker** | Data Service | Track token emissions and rewards | TypeScript + Emissions Adapters | ‚úÖ Active |
| **Search Service** | Search Engine | Protocol and token search functionality | Elasticsearch + TypeScript | ‚úÖ Active |

#### External Adapters

| Adapter | Purpose | Repository | Integration |
|---------|---------|------------|-------------|
| **DefiLlama-Adapters** | Protocol TVL calculation | `./DefiLlama-Adapters` | Git submodule |
| **Dimension-Adapters** | Fee, volume, user analytics | `./dimension-adapters` | Git submodule |
| **Emissions-Adapters** | Token emission tracking | `./emissions-adapters` | Git submodule |

#### Key Dependencies

| Dependency | Version | Purpose | Category |
|------------|---------|---------|----------|
| `@defillama/sdk` | ^5.0.172 | DeFi protocol integration SDK | Core |
| `ethers` | ^6.0.0 | Ethereum blockchain interaction | Blockchain |
| `typeorm` | ^0.3.11 | Database ORM | Database |
| `postgres` | ^3.3.1 | PostgreSQL client | Database |
| `hyper-express` | ^6.8.7 | High-performance HTTP server | API |
| `@elastic/elasticsearch` | ^8.13.1 | Search engine client | Search |
| `serverless` | ^3.0.0 | Serverless deployment framework | Infrastructure |

### üí∞ Coins Service (`coins/`)

**Service Overview**: Cryptocurrency price API providing real-time and historical price data across multiple blockchains

#### Core Components

| Component | Type | Purpose | Technology | Status |
|-----------|------|---------|------------|--------|
| **Price API** | REST API | Current and historical price endpoints | Serverless + AWS API Gateway | ‚úÖ Active |
| **Price Aggregator** | Data Service | Aggregate prices from multiple sources | TypeScript + Kafka | ‚úÖ Active |
| **Multi-chain Scanner** | Blockchain Service | Scan multiple blockchains for token data | ethers.js + @solana/web3.js | ‚úÖ Active |
| **CoinGecko Integration** | External API | Integrate with CoinGecko price feeds | TypeScript + axios | ‚úÖ Active |
| **Bridge Handler** | Data Service | Handle cross-chain token price reconciliation | TypeScript + @defillama/sdk | ‚úÖ Active |
| **Cache Manager** | Caching Service | High-performance price data caching | Redis + ioredis | ‚úÖ Active |
| **Message Queue** | Messaging | Asynchronous price update processing | Kafka + kafkajs | ‚úÖ Active |
| **GraphQL Client** | API Client | Query blockchain subgraphs | graphql-request | ‚úÖ Active |

#### Key Dependencies

| Dependency | Version | Purpose | Category |
|------------|---------|---------|----------|
| `@defillama/sdk` | ^5.0.152 | DeFi protocol integration SDK | Core |
| `ethers` | ^6.0.0 | Ethereum blockchain interaction | Blockchain |
| `@solana/web3.js` | ^1.73.3 | Solana blockchain interaction | Blockchain |
| `ioredis` | ^5.3.2 | Redis client for caching | Cache |
| `kafkajs` | ^2.2.4 | Kafka message queue client | Messaging |
| `graphql-request` | ^5.1.0 | GraphQL client | API |
| `postgres` | ^3.4.3 | PostgreSQL client | Database |
| `serverless` | ^2.31.0 | Serverless deployment framework | Infrastructure |

### üîß Common Library (`common/`)

**Service Overview**: Shared utilities and configuration data used across services

#### Components

| Component | Type | Purpose | Technology | Status |
|-----------|------|---------|------------|--------|
| **Chain Mappings** | Configuration | Map chain IDs to CoinGecko identifiers | TypeScript constants | ‚úÖ Active |
| **Shared Types** | Type Definitions | Common TypeScript interfaces | TypeScript | ‚úÖ Active |
| **Utility Functions** | Helper Library | Shared utility functions | TypeScript | ‚úÖ Active |

#### Chain Support

| Chain | CoinGecko ID | Status | Notes |
|-------|--------------|--------|-------|
| Ethereum | `ethereum` | ‚úÖ Active | Primary chain |
| Binance Smart Chain | `binance-smart-chain` | ‚úÖ Active | High volume |
| Polygon | `polygon-pos` | ‚úÖ Active | Layer 2 |
| Avalanche | `avalanche` | ‚úÖ Active | High throughput |
| Arbitrum | `arbitrum-one` | ‚úÖ Active | Layer 2 |
| Solana | `solana` | ‚úÖ Active | Non-EVM |
| Fantom | `fantom` | ‚úÖ Active | DeFi focused |
| *...270+ more chains* | *various* | ‚úÖ Active | Full list in source |

## üóÑÔ∏è Data Components

### Database Tables

#### DeFi Service Tables
| Table | Type | Purpose | Size | Retention |
|-------|------|---------|------|-----------|
| `protocols` | DynamoDB | Protocol metadata and configurations | ~3K records | Permanent |
| `tvl_data` | DynamoDB | Time-series TVL data | ~100M records | 2 years |
| `historical_tvl` | PostgreSQL | Historical analysis data | ~50M records | Permanent |
| `governance_data` | PostgreSQL | Governance proposals and votes | ~10K records | Permanent |
| `emissions_data` | DynamoDB | Token emission schedules | ~5K records | Permanent |

#### Coins Service Tables
| Table | Type | Purpose | Size | Retention |
|-------|------|---------|------|-----------|
| `coin_prices` | DynamoDB | Current token prices | ~100K records | 30 days |
| `price_history` | PostgreSQL | Historical price data | ~1B records | Permanent |
| `token_metadata` | PostgreSQL | Token information and mappings | ~500K records | Permanent |
| `bridge_mappings` | PostgreSQL | Cross-chain token mappings | ~50K records | Permanent |

### Cache Components

| Cache | Technology | TTL | Purpose | Size |
|-------|------------|-----|---------|------|
| **Price Cache** | Redis | 30s | Real-time price data | ~100MB |
| **TVL Cache** | Redis | 5min | Protocol TVL data | ~50MB |
| **API Response Cache** | CloudFront | 1-60min | API response caching | ~1GB |
| **Query Cache** | PostgreSQL | 15min | Database query results | ~500MB |

## üîå Integration Components

### Blockchain Integrations

| Blockchain | RPC Provider | Purpose | Status |
|------------|--------------|---------|--------|
| **Ethereum** | Multiple providers | TVL calculation, price data | ‚úÖ Active |
| **BSC** | BSC RPC | TVL calculation, price data | ‚úÖ Active |
| **Polygon** | Polygon RPC | TVL calculation, price data | ‚úÖ Active |
| **Avalanche** | Avalanche RPC | TVL calculation, price data | ‚úÖ Active |
| **Solana** | Solana RPC | Price data, token metadata | ‚úÖ Active |
| **Arbitrum** | Arbitrum RPC | TVL calculation, price data | ‚úÖ Active |

### External API Integrations

| Service | Purpose | Rate Limit | Status |
|---------|---------|------------|--------|
| **CoinGecko API** | Price data aggregation | 50 calls/min | ‚úÖ Active |
| **The Graph** | Subgraph data queries | 1000 queries/day | ‚úÖ Active |
| **Snapshot** | Governance data | 100 calls/min | ‚úÖ Active |
| **Protocol APIs** | Direct protocol data | Varies | ‚úÖ Active |

## üöÄ Deployment Components

### AWS Infrastructure

| Component | Service | Purpose | Configuration |
|-----------|---------|---------|---------------|
| **Lambda Functions** | AWS Lambda | Serverless compute | Node.js 16.x/20.x, 250MB-10GB |
| **API Gateway** | AWS API Gateway | HTTP API routing | Regional, custom domain |
| **DynamoDB** | AWS DynamoDB | NoSQL database | On-demand billing, global tables |
| **RDS PostgreSQL** | AWS RDS | Relational database | Multi-AZ, automated backups |
| **ElastiCache Redis** | AWS ElastiCache | Caching layer | Cluster mode, 6 nodes |
| **S3 Buckets** | AWS S3 | Object storage | Versioning, lifecycle policies |
| **CloudFront** | AWS CloudFront | CDN | Global distribution, custom caching |

### Monitoring Components

| Component | Purpose | Technology | Alerts |
|-----------|---------|------------|--------|
| **Application Monitoring** | Performance tracking | AWS X-Ray | ‚úÖ Enabled |
| **Error Tracking** | Error monitoring | Sentry | ‚úÖ Enabled |
| **Log Aggregation** | Centralized logging | CloudWatch Logs | ‚úÖ Enabled |
| **Metrics Dashboard** | System metrics | CloudWatch Dashboards | ‚úÖ Enabled |
| **Health Checks** | Service availability | CloudWatch Alarms | ‚úÖ Enabled |

## üìä Performance Metrics

### Service Performance

| Service | Avg Response Time | Throughput | Availability |
|---------|------------------|------------|--------------|
| **DeFi API** | <200ms | 1000 req/sec | 99.9% |
| **Coins API** | <100ms | 2000 req/sec | 99.9% |
| **Database** | <50ms | 5000 queries/sec | 99.95% |
| **Cache** | <5ms | 10000 ops/sec | 99.99% |

---

*This component inventory was generated using BMAD Method v6.0.0-alpha.0 system analysis.*
