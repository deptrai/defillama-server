# DeFiLlama Server - API Contracts

*Generated by BMAD Method v6.0.0-alpha.0 on 2025-10-13*

## üåê API Overview

DeFiLlama Server exposes two main API services providing comprehensive DeFi analytics and cryptocurrency price data. All APIs use RESTful conventions with JSON responses and support CORS for web applications.

### Base URLs
- **DeFi API**: `https://api.llama.fi`
- **Coins API**: `https://coins.llama.fi`
- **Documentation**: https://defillama.com/docs/api

## üè¶ DeFi API Contracts

### Protocol Endpoints

#### GET /protocols
**Purpose**: List all tracked DeFi protocols

**Response Schema**:
```typescript
interface Protocol {
  id: string;
  name: string;
  address: string;
  symbol: string;
  url: string;
  description: string;
  chain: string;
  logo: string;
  audits: string;
  audit_note: string;
  gecko_id: string;
  cmcId: string;
  category: string;
  chains: string[];
  module: string;
  twitter: string;
  forkedFrom: string[];
  oracles: string[];
  listedAt: number;
  methodology: string;
  slug: string;
  tvl: number;
  chainTvls: Record<string, number>;
  change_1h: number;
  change_1d: number;
  change_7d: number;
  tokenBreakdowns: Record<string, number>;
  mcap: number;
}

interface ProtocolsResponse {
  protocols: Protocol[];
}
```

**Example Request**:
```bash
curl "https://api.llama.fi/protocols"
```

**Example Response**:
```json
{
  "protocols": [
    {
      "id": "1",
      "name": "Uniswap",
      "address": "0x1f9840a85d5af5bf1d1762f925bdaddc4201f984",
      "symbol": "UNI",
      "chain": "Ethereum",
      "category": "Dexes",
      "tvl": 4500000000,
      "change_1d": 2.5,
      "chains": ["Ethereum", "Polygon", "Arbitrum"]
    }
  ]
}
```

#### GET /protocol/{protocol}
**Purpose**: Get detailed data for a specific protocol

**Parameters**:
- `protocol` (string): Protocol slug or ID

**Response Schema**:
```typescript
interface ProtocolDetail {
  id: string;
  name: string;
  address: string;
  symbol: string;
  chain: string;
  category: string;
  tvl: number;
  chainTvls: Record<string, ChainTvl>;
  tokens: Token[];
  tokensInUsd: Token[];
  methodology: string;
  misrepresentedTokens: boolean;
  hallmarks: Hallmark[];
  currentChainTvls: Record<string, number>;
  chainTvls: Record<string, ChainTvlHistory[]>;
}

interface ChainTvl {
  tvl: number;
  tvlPrevDay: number;
  tvlPrevWeek: number;
  tvlPrevMonth: number;
}

interface ChainTvlHistory {
  date: number;
  totalLiquidityUSD: number;
}
```

### TVL Endpoints

#### GET /tvl/{protocol}
**Purpose**: Get historical TVL data for a protocol

**Response Schema**:
```typescript
interface TvlResponse {
  date: number;
  totalLiquidityUSD: number;
}[]
```

#### GET /charts
**Purpose**: Get historical TVL charts for all protocols

**Query Parameters**:
- `chain` (optional): Filter by specific chain

**Response Schema**:
```typescript
interface ChartData {
  date: number;
  totalLiquidityUSD: number;
}[]
```

### Yield Endpoints

#### GET /yields
**Purpose**: Get yield farming opportunities

**Response Schema**:
```typescript
interface YieldPool {
  chain: string;
  project: string;
  symbol: string;
  tvlUsd: number;
  apy: number;
  apyBase: number;
  apyReward: number;
  rewardTokens: string[];
  pool: string;
  apyPct1D: number;
  apyPct7D: number;
  apyPct30D: number;
  stablecoin: boolean;
  ilRisk: string;
  exposure: string;
  predictions: {
    predictedClass: string;
    predictedProbability: number;
    binnedConfidence: number;
  };
}

interface YieldsResponse {
  status: string;
  data: YieldPool[];
}
```

## üí∞ Coins API Contracts

### Price Endpoints

#### GET /prices/current/{coins}
**Purpose**: Get current prices for specified tokens

**Parameters**:
- `coins` (string): Comma-separated list of coin identifiers

**Coin Identifier Formats**:
- `ethereum:0x...` - Token address on specific chain
- `coingecko:bitcoin` - CoinGecko ID
- `defillama:1` - DeFiLlama internal ID

**Response Schema**:
```typescript
interface PriceResponse {
  coins: Record<string, CoinPrice>;
}

interface CoinPrice {
  decimals: number;
  price: number;
  symbol: string;
  timestamp: number;
  confidence: number;
}
```

**Example Request**:
```bash
curl "https://coins.llama.fi/prices/current/ethereum:0xa0b86a33e6441e6c8d3e4c7b8b8b8b8b8b8b8b8b"
```

**Example Response**:
```json
{
  "coins": {
    "ethereum:0xa0b86a33e6441e6c8d3e4c7b8b8b8b8b8b8b8b8b": {
      "decimals": 18,
      "price": 1850.25,
      "symbol": "ETH",
      "timestamp": 1697123456,
      "confidence": 0.99
    }
  }
}
```

#### GET /prices/historical/{timestamp}/{coins}
**Purpose**: Get historical prices at specific timestamp

**Parameters**:
- `timestamp` (number): Unix timestamp
- `coins` (string): Comma-separated coin identifiers

**Response Schema**: Same as current prices

#### POST /prices/batch
**Purpose**: Batch price requests for multiple timestamps

**Request Body**:
```typescript
interface BatchRequest {
  coins: string[];
  timestamps: number[];
}
```

**Response Schema**:
```typescript
interface BatchResponse {
  coins: Record<string, Record<number, CoinPrice>>;
}
```

### Token Metadata Endpoints

#### GET /coins
**Purpose**: Search and list token metadata

**Query Parameters**:
- `search` (string): Search term
- `chain` (string): Filter by chain
- `limit` (number): Results limit (default: 50)

**Response Schema**:
```typescript
interface TokenMetadata {
  id: string;
  symbol: string;
  name: string;
  address: string;
  chain: string;
  decimals: number;
  logoURI: string;
  coingeckoId: string;
  listedAt: number;
}

interface CoinsResponse {
  coins: TokenMetadata[];
}
```

## üîí Authentication & Rate Limiting

### Public API Access
- **Authentication**: None required for public endpoints
- **Rate Limiting**: 
  - DeFi API: 300 requests per 5 minutes per IP
  - Coins API: 600 requests per 5 minutes per IP
- **CORS**: Enabled for all origins

### Rate Limit Headers
```http
X-RateLimit-Limit: 300
X-RateLimit-Remaining: 299
X-RateLimit-Reset: 1697123456
```

### Error Responses
```typescript
interface ErrorResponse {
  error: string;
  message: string;
  statusCode: number;
}
```

**Common Error Codes**:
- `400` - Bad Request (invalid parameters)
- `404` - Not Found (protocol/token not found)
- `429` - Too Many Requests (rate limit exceeded)
- `500` - Internal Server Error

## üìä Response Formats

### Standard Response Wrapper
```typescript
interface ApiResponse<T> {
  data: T;
  status: 'success' | 'error';
  timestamp: number;
  version: string;
}
```

### Pagination
```typescript
interface PaginatedResponse<T> {
  data: T[];
  pagination: {
    page: number;
    limit: number;
    total: number;
    hasNext: boolean;
    hasPrev: boolean;
  };
}
```

### Timestamps
- All timestamps are Unix timestamps (seconds since epoch)
- UTC timezone
- Example: `1697123456` = 2023-10-12 12:30:56 UTC

## üåç Chain Support

### Supported Chains
| Chain | Identifier | Native Token | Status |
|-------|------------|--------------|--------|
| Ethereum | `ethereum` | ETH | ‚úÖ Active |
| Binance Smart Chain | `bsc` | BNB | ‚úÖ Active |
| Polygon | `polygon` | MATIC | ‚úÖ Active |
| Avalanche | `avax` | AVAX | ‚úÖ Active |
| Arbitrum | `arbitrum` | ETH | ‚úÖ Active |
| Optimism | `optimism` | ETH | ‚úÖ Active |
| Solana | `solana` | SOL | ‚úÖ Active |
| Fantom | `fantom` | FTM | ‚úÖ Active |
| *...270+ more* | *various* | *various* | ‚úÖ Active |

### Chain-Specific Endpoints

#### GET /chains
**Purpose**: List all supported chains

**Response Schema**:
```typescript
interface Chain {
  name: string;
  chainId: number;
  gecko_id: string;
  tvl: number;
  tokenSymbol: string;
  cmcId: string;
}
```

## üìà WebSocket API (Real-time)

### Connection
```javascript
const ws = new WebSocket('wss://api.llama.fi/ws');
```

### Subscription Messages
```typescript
interface SubscribeMessage {
  type: 'subscribe';
  channel: 'prices' | 'tvl' | 'protocols';
  params?: {
    coins?: string[];
    protocols?: string[];
  };
}
```

### Real-time Updates
```typescript
interface PriceUpdate {
  type: 'price_update';
  data: {
    coin: string;
    price: number;
    timestamp: number;
  };
}

interface TvlUpdate {
  type: 'tvl_update';
  data: {
    protocol: string;
    tvl: number;
    timestamp: number;
  };
}
```

---

*This API documentation was generated using BMAD Method v6.0.0-alpha.0 codebase analysis.*
